<form action="" method="post" name="frmUser" flexy:ignore id="frmUser">
    <p>
    {if:isAdd}
    <input name="action" type="hidden" value="insert" />
    {if:redir}
    <input type="hidden" name="redir" value="{redir}" />
    {end:}
    {else:}
    <input name="action" type="hidden" value="update" />
    <input name="user[usr_id]" type="hidden" value="{user.usr_id}" />
    <input name="user[role_id_orig]" type="hidden" value="{user.role_id}" />
    <input name="user[organisation_id_orig]" type="hidden" value="{user.organisation_id}" />
    {end:}
    </p>
    <h1 class="pageTitle">{translate(pageTitle)}</h1>
    <span flexy:if="msgGet()">{msgGet()}</span>

    <table class="narrow">
        <tr>
            <th colspan="2">{translate(#Personal Details#)}</th>
        </tr>

        <tr>
            <td class="fieldName" width="50%"><span class="error">*</span>{translate(#Username#)}</td>
            <td align="left" width="50%">
                <div class="error" flexy:if="error[username]">
                    {translate(error[username])}
                </div><input name="user[username]" type="text" value="{user.username}" />
            </td>
        </tr>

        <tr>
            <td class="fieldName">{translate(#First Name#)}</td>
            <td align="left"><input name="user[first_name]" type="text" value="{user.first_name}" /></td>
        </tr>
        <tr>
            <td class="fieldName">{translate(#Last Name#)}</td>
            <td align="left"><input name="user[last_name]" type="text" value="{user.last_name}" /></td>
        </tr>

    {if:isAdd}
        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Password#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[passwd]">
                    {translate(error[passwd])}
                </div><input name="user[passwd]" type="password" value="{user.passwd}" />
            </td>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Confirm Password#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[password_confirm]">
                    {translate(error[password_confirm])}
                </div><input name="user[password_confirm]" type="password" value="{user.password_confirm}" />
            </td>
        </tr>
    {end:}
        {if:isAdmin()}
            {if:conf[OrgMgr][enabled]}
        	<tr>
        		<td class="fieldName">Organisation Name</td>
        		<td align="left">
                	<select name="user[organisation_id]">
                        {generateSelect(aOrgs,user.organisation_id):h}
                	</select>
               </td>
        	</tr>
            {end:}
        {end:}

        <tr>
            <th colspan="2">{translate(#Location#)}</th>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Address 1#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[addr_1]">
                    {translate(error[addr_1])}
                </div><input name="user[addr_1]" type="text" value="{user.addr_1}" />
            </td>
        </tr>

        <tr>
            <td class="fieldName">{translate(#Address 2#)}</td>
            <td align="left"><input name="user[addr_2]" type="text" value="{user.addr_2}" /></td>
        </tr>

        <tr>
            <td class="fieldName">{translate(#Address 3#)}</td>
            <td align="left"><input name="user[addr_3]" type="text" value="{user.addr_3}" /></td>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#City#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[city]">
                    {translate(error[city])}
                </div><input name="user[city]" type="text" value="{user.city}" />
            </td>
        </tr>

        <tr>
            <td class="fieldName">{translate(#County/State/Province#)}</td>
            <td align="left">
                <select name="user[region]">
                    {generateSelect(states,user.region):h}
                </select>
            </td>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#ZIP/Postal Code#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[post_code]">
                    {translate(error[post_code])}
                </div><input name="user[post_code]" type="text" value="{user.post_code}" />
            </td>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Country#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[country]">
                    {translate(error[country])}
                </div>
                <select name="user[country]">
                    {generateSelect(countries,user.country):h}
                </select>
            </td>
        </tr>

        <tr>
            <th colspan="2">{translate(#Contact#)}</th>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Email#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[email]">
                    {translate(error[email])}
                </div><input name="user[email]" type="text" value="{user.email}" />
            </td>
        </tr>

        <tr>
            <td class="fieldName">{translate(#Telephone#)}</td>
            <td align="left"><input name="user[telephone]" type="text" value="{user.telephone}" /></td>
        </tr>

        <tr>
            <td class="fieldName">{translate(#Mobile#)}</td>
            <td align="left"><input name="user[mobile]" type="text" value="{user.mobile}" /></td>
        </tr>
        {if:isAdmin()}
        <tr>
            <td class="fieldName">{translate(#Is Active?#)}</td>
            <td align="left"><input name="user[is_acct_active]" flexy:raw="{isAcctActive}" type="checkbox" value="1" /> {translate(#check if active#)}</td>
        </tr>
        {end:}
        <tr>
            <th colspan="2">{translate(#Security#)}</th>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Security question#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[security_question]">
                    {translate(error[security_question])}
                </div>
                <select name="user[security_question]">
                    {generateSelect(aSecurityQuestions,user.security_question):h}
                </select>
            </td>
        </tr>

        <tr>
            <td class="fieldName"><span class="error">*</span>{translate(#Answer#)}</td>
            <td align="left">
                <div class="error" flexy:if="error[security_answer]">
                    {translate(error[security_answer])}
                </div><input name="user[security_answer]" type="text" value="{user.security_answer}" />
            </td>
        </tr>
        {if:isAdmin()}
    	<tr>
    		<td class="fieldName">{translate(#Role#)}</td>
    		<td align="left">
                <select name="user[role_id]">
                    {generateSelect(aRoles,user.role_id):h}
                </select>
            </td>
    	</tr>
        {end:}
        <tr>
            <td valign="top" align="center" colspan="2">
                <input class="wideButton" name="submitted" value="{translate(#Submit#)}" type="submit" />&nbsp;
                {if:isAdmin()}
                    <input class="wideButton" type="button" value="{translate(#Cancel#)}"
                        onclick="javascript:document.location.href='{makeUrl(##,#user#,#user#)}'" />
                {else:}
                    <input class="wideButton" value="{translate(#Reset#)}" type="reset" />
                {end:}
            </td>
        </tr>

        <tr>
            <td valign="top" align="center" colspan="2">
                <span class="error">*</span>
                <span>{translate(#denotes required field#)}</span>
            </td>
        </tr>
    </table>
</form>
